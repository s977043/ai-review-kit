---
name: code-review
description: PR 向けの自動コードレビュー。セキュリティ・性能・品質・テスト観点で差分を評価する。
license: Apache-2.0
compatibility: 差分とリポジトリの読み取り権限がある環境で利用する。
metadata:
  author: river-reviewer
  version: '0.1.0'
allowed-tools:
  - Read
---

## Goal

差分から重大リスクを早期に特定し、具体的な修正指針を返す。

## When to use

- PR レビューやセルフレビューで網羅的に観点を洗いたいとき
- 変更が広範囲で、セキュリティ/性能/品質/テストの抜け漏れが懸念されるとき

## Steps

1. 変更差分を把握し、影響範囲とリスクの高い箇所を特定する。
2. 観点別に確認する。
   - セキュリティ: インジェクション、認可漏れ、ハードコード秘密、危険な外部入力。
   - 性能: N+1、不要な再描画/コピー、キャッシュ不足、同期 I/O。
   - 品質: 責務肥大、ネーミング不明瞭、例外/エラーログ欠如、マジックナンバー。
   - テスト: 新規コードに対するテスト有無、挙動を保証するアサーションか、フレーク要因。
3. 重大度ごとにコメント化し、Why と Fix をセットで提示する。
4. 良い実装があればポジティブフィードバックも残す。

## Output format

- Critical: **ファイル:行** 危険な欠陥と修正案
- Suggestion: **ファイル:行** 品質/性能改善の提案と理由
- Nit: 軽微な改善
- What's Good: 評価できる実装やテスト

## Edge cases

- プロジェクト固有のセキュリティ/コーディング規約がある場合、それを優先する。
- 差分が大きい場合は、リスクの高い領域を優先して確認する。
