# コードレビュー観点について（概念ベース・AI/Human共用）
> このチェックリストは観点を採ろえるためのものです。  
> 具体ルールは各プロジェクトで決めてください【本書は“矛盾のない最小公倍数”を目指します】。

## 0. クイック判定について（最初にみる）
- [ ] 目的が一言で言える（PRタイトル/首条で伝わる）
- [ ] 変更は**小さく焦点化**されている（無関係な差分なし）
- [ ] テスト or 動作証言跡があり、再現手順が**簡潔**（AI/人がすぐ確認できる）

## 1. 可読性（Readability）
- [ ] 名前だけで役割と粒度がわかる（関数＝動詞始まり、略言を避ける）
- [ ] コメントは**なぜ（背景/前提/選択理由）**を説明（実装の逞語ではない）
- [ ] 1関数ち1責務。長文化していない（画面1枚程度を目定に分割）
- [ ] 仕様の「入力→処理→出力」が追える

## 2. 厳密性（Precision）
- [ ] 比較は型を含めて明確（例：`===` / `??` / `?.` の適用が妥当）
- [ ] 未定義/空/NaN/境界の扱いが曖昧でない（正常系で true になる式）
- [ ] 数値・単位・範囲にマジックがない（根拠 or 定数化）

## 3. 体補と差分（Diff Hygiene）
- [ ] フォーマッタ/リンタを通した差分（ノイズなし）
- [ ] 命名/並び替え等の**意味のない差分**が混在していない

## 4. 命名・データ（Naming & Data）
- [ ] 変数/関数は用途が推測可能（必要なら型が想起できる）
- [ ] 定数化（OAOO：一群所定義）。マジックナンバー禁止
- [ ] データ構造の責務と境界が明確（DTO/Domain/表示用の混線なし）

## 5. 設計（Design）
- [ ] まず**保有（composition）**、継承は必要最小限
- [ ] 外部からの直接アクセスを抑制（必要程度はゲッター/APIで明示）
- [ ] 参照順序が読みやすい（「参照されるもの→参照するもの」）

## 6. 制御構造（Control Flow）
- [ ] ブロック `{}` は原則省略しない（1行のみ例外/改行禁止）
- [ ] ループ/分對は意図に合う構文（`for…of/in`、関数型は短等関数）
- [ ] `switch` の fall-through は**意図明示**

## 7. エラー処理（Error Handling）
- [ ] 起こりうる論理的エラーのみ捕捗（揉みつぶし禁止）
- [ ] 例外の伝播方針が一貫（呼び出し側にとって予測可能）
- [ ] ログ/メッセージは原因追跪に十分

## 8. 可読性 vs 性能（Performance）
- [ ] 可読性を大きく損なう最適化は**稀な例外**（必要性の根拠あり）
- [ ] 最適化した章所にコメント：`// performance optimized: <理由/前提/測定>`

## 9. 変更の単位（Change Unit）
- [ ] 1PR=1目的（整形/リネームと機能変更は分離）
- [ ] PR本文に**目的・変更点・影響範囲・検証方法**がある

## 10. AI連携の観点（Agent-Ready）
- [ ] **決定的（deterministic）**に再現できる：対話不要、コマンド1〜2個で検証可能
- [ ] 外部依存の前提が明記（環境変数・サービス・権限・シード値）
- [ ] 入出力が**ファイル/ログ**に残る（AIが後工程で参照できる）
- [ ] 「人がボトルネックにならない」段口（自動でGreenになるまでの道筋）

## 11. SDD × TDD（仕様と検証）
- [ ] 最小の**仕様断面**が自然文で明示（何を満たすとDoneか）
- [ ] 失敗するテスト→最小実装→Green→リファクタの**痕跡**がある
- [ ] PRに**テスト結果 or 実行ログ**が貼られている（再現手順が短い）

## 12. セキュリティ/秘匿（Minimal）
- [ ] 秘密はコミットしない（`.env*` は除外。必要なら `.env.example`）
- [ ] 外部APIは**例外処理・タイムアウト**を持つ
- [ ] 個人情報/ライセンス/出典の扱いに問題がない

## 13. UI/UX（該当時）
- [ ] a11y（ラベル/ARIA/フォーカス）・レスポンシブ配慮
- [ ] エラー表示や空状態の仕様が定義されている

---

## 14. 承認/差戻しの基準
**Approve**：上記観点で将来の保守/連携に耐える  
**Request Changes**：
- 意図が読み取れない命名/多重責務
- 比較/境界/未定義の扱いが曖昧
- マジック/重複の放置
- 過
-
- ## 15. マルチエージェント開発の観点 (SDD, TDD, Non-Blocking)

- **-DD（仕様駐動開発）**：エージェント間の誤解を避けるために、自然言語だけでなく共有仕様を持つ
  - [ ] 仕様は `requirements.md` や OpenAPI など構造化文書として定義されている　（「平日」など用語の定義やビジネスルールを明記）
  - [ ] 曖昧な自然言語の仕様が残っていない　（誰が読んでも同じ理解になる）
- **TDD（テスト駐動開発）**：実装前にテストを書き、ゴールを明確にする
  - [ ] 受け入れテストがユーザ視点で記述されている　（シナリオと期待する動作を明示）
  - [ ] インタフェース/契約テストで境界条件やエッジケースをカバーしている　（例：時間や日付の織り上がり等）
- **ノンブロッキング（人間は進行を止めない）**：エージェントの進行を始めせず、段階的にレビューする
  - [ ] エージェント間の対話や決定がログに記録されている　（後から経程を追える）
  - [ ] テストがグリーンになり、設計レビューやドキュメント更新が済んだ後に人間がレビューする
- **注意点**については次のぽいントを確認する
  - [ ] 複雑な業務ロジックやセキュリティは人間が最終判断する
  - [ ] 学習データの偏りや外部APIの費用など、エージェントでは気付けないリスクを確認する
剰最適化で可読性崩壊（根拠なし）
- 再現不能（手動前提・対話依存）や証跡不足
